# å¼€å§‹ç¼–å†™æ’ä»¶

æœ¬æ–‡ç« å°†ä»‹ç»å¦‚ä½•åˆ›å»ºã€è°ƒè¯•å¹¶è¿è¡Œ ClassIsland çš„æ’ä»¶é¡¹ç›®ã€‚

::: warning
æœ¬æ–‡ç« æ‰€æ¶‰åŠå†…å®¹ä»åœ¨å¼€å‘ä¸­ï¼Œéšæ—¶å¯èƒ½å‘ç”Ÿå˜åŠ¨ã€‚è¯·æ³¨æ„å…³æ³¨æ–‡æ¡£æ›´å˜ã€‚
:::

åœ¨å¼€å§‹ä¹‹å‰ï¼Œæ‚¨éœ€è¦æŒ‰ç…§[è®¾ç½® ClassIsland æ’ä»¶å¼€å‘ç¯å¢ƒ](../get-started/devlopment-plugins.md)çš„æŒ‡å¼•è®¾ç½®æ’ä»¶å¼€å‘ç¯å¢ƒã€‚

## åˆ›å»ºé¡¹ç›®

æœ‰ä¸¤ç§æ–¹æ³•åˆ›å»ºé¡¹ç›®ï¼š

:::tabs 
@tab ä½¿ç”¨æ¨¡æ¿ï¼ˆæ¨èï¼‰

æ‚¨å¯ä»¥ä½¿ç”¨é¡¹ç›®æ¨¡æ¿å¿«é€Ÿå¼€å§‹å¼€å‘ã€‚

1. å‰å¾€ [æ’ä»¶æ¨¡æ¿ä»“åº“](https://github.com/ClassIsland/PluginTemplate/releases/latest) ä¸­ä¸‹è½½æ’ä»¶æ¨¡æ¿ï¼ˆPluginTemplate.zipï¼‰
2. å°†ä¸‹è½½çš„å‹ç¼©åŒ…å¤åˆ¶åˆ°`%USERPROFILE%\Documents\Visual Studio 2022\Templates\ProjectTemplates`ï¼ˆä»¥ VS 2022 ä¸ºä¾‹ï¼Œä»¥ä½ ç”µè„‘ä¸Šçš„å…·ä½“ç›®å½•ä¸ºå‡†ï¼‰
3. æ‰“å¼€ Visual Studio
4. åœ¨ã€å¯åŠ¨çª—å£ã€‘ç‚¹å‡»ã€åˆ›å»ºæ–°é¡¹ç›®ã€‘
    ![1727776635657](image/create-project/1727776635657.png)
5. åœ¨æ¨¡æ¿åˆ—è¡¨æœç´¢â€œclassislandâ€ï¼Œé€‰æ‹©ã€ClassIslad Hello world æ’ä»¶ã€‘æ¨¡æ¿åˆ›å»ºé¡¹ç›®
    ![1727776654662](image/create-project/1727776654662.png)
6. å¤§åŠŸå‘ŠæˆğŸ‰ï¼Œå¼€å§‹ä½ çš„ ClassIsland æ’ä»¶å¼€å‘ä¹‹æ—…å§ï¼
    ![1727776704758](image/create-project/1727776704758.png)

æ’ä»¶æ¨¡æ¿å·²ç»é…ç½®å¥½æœ¬æ–‡ç« çš„å¤§éƒ¨åˆ†å†…å®¹ï¼Œç»§ç»­é˜…è¯»æœ¬æ–‡ç« æ—¶æ‚¨å¯ä»¥çœç•¥æ¥ä¸‹æ¥çš„æ­¥éª¤ï¼Œåªéœ€äº†è§£è¿™äº›æ–‡ä»¶çš„ä½œç”¨å³å¯ã€‚

@tab æ‰‹åŠ¨åˆ›å»º

ä»¥ä¸‹æ­¥éª¤ä»¥åœ¨ Visual Studio 2022 ä¸­çš„æ“ä½œä¸ºä¾‹ã€‚

1. åˆ›å»ºä¸€ä¸ªæ¨¡æ¿ä¸ºã€WPF ç±»åº“ã€‘çš„é¡¹ç›®ï¼Œé€‰æ‹©ã€.NET 8ã€‘ç›®æ ‡æ¡†æ¶
2. é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œåœ¨ã€è§£å†³æ–¹æ¡ˆèµ„æºç®¡ç†å™¨ã€‘ä¸­å³é”®é¡¹ç›®ï¼Œåœ¨å¼¹å‡ºçš„æ“ä½œèœå•ä¸­ç‚¹å‡»ã€ç®¡ç† Nuget ç¨‹åºåŒ…â€¦ã€‘æ“ä½œã€‚

    ![1721876643763](image/create-project/1721876643763.png)

3. æœç´¢å¹¶å®‰è£…åŒ…ã€ClassIsland.PluginSdkã€‘ã€‚

    ![1721876680236](image/create-project/1721876680236.png)

    ::: info ä½¿ç”¨é¢„è§ˆç‰ˆ SDK
    æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ  GitHub Packages æºæ¥è·å–ä» GitHub Actions æ„å»ºçš„æœ€æ–°çš„ SDK åŒ…ã€‚æ‚¨éœ€è¦æŒ‰ç…§[æ­¤æ–‡ç« ](https://docs.github.com/zh/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens)çš„æ–¹æ³•åˆ›å»º GitHub ä¸ªäººè®¿é—®ä»¤ç‰Œï¼ˆclassicï¼‰ï¼Œå¹¶è‡³å°‘èµ‹äºˆ `read:packages` æƒé™ã€‚ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ  ClassIsland çš„ GitHub Packages Nuget æºï¼š

    ``` shell
    dotnet nuget add source --usernameï¼ˆä½ çš„ç”¨æˆ·åï¼‰ --passwordï¼ˆä½ çš„ GitHub ä¸ªäººè®¿é—®ä»¤ç‰Œï¼‰ --store-password-in-clear-text --name github "https://nuget.pkg.github.com/ClassIsland/index.json"
    ```
    :::

4. æ‰“å¼€é¡¹ç›®æ–‡ä»¶ï¼Œæ·»åŠ  `EnableDynamicLoading` å±æ€§ä»¥å…è®¸æ’ä»¶è¢«åŠ¨æ€åŠ è½½ï¼Œå¹¶åœ¨ `ClassIsland.PluginSdk` çš„å¼•ç”¨é¡¹ä¸Šè®¾ç½®`ExcludeAssets` å±æ€§ä¸º `runtime` ä»¥é˜»æ­¢æ’ä»¶ SDK ç›¸å…³ä¾èµ–é¡¹æµå…¥æ„å»ºç»“æœã€‚

    ```xml title="MyPlugin.csproj" hl_lines="9 13"
    <Project Sdk="Microsoft.NET.Sdk">

        <PropertyGroup>
            <TargetFramework>net8.0-windows</TargetFramework>
            <Nullable>enable</Nullable>
            <UseWPF>true</UseWPF>
            <ImplicitUsings>enable</ImplicitUsings>
            <PlatformTarget>x64</PlatformTarget>
            <EnableDynamicLoading>True</EnableDynamicLoading>
        </PropertyGroup>
        <ItemGroup>
            <PackageReference Include="ClassIsland.PluginSdk" Version="1.0.0">
                <ExcludeAssets>runtime</ExcludeAssets>
            </PackageReference>
        </ItemGroup>
    </Project>

    ```

:::

## æ’ä»¶æ¸…å•æ–‡ä»¶

æ’ä»¶æ¸…å•æ–‡ä»¶åŒ…å«äº†æ’ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚æ’ä»¶å…¥å£ç¨‹åºé›†ç­‰ã€‚ä½¿ç”¨æ’ä»¶æ¨¡æ¿åˆ›å»ºçš„é¡¹ç›®çš„æ¸…å•æ–‡ä»¶å·²ç»åŸºæœ¬é…ç½®å®Œæ¯•ï¼Œæ‚¨åªéœ€æŒ‰ç…§éœ€è¦è¿›è¡Œå¾®è°ƒã€‚

**å¦‚æœæ‚¨æ‰‹åŠ¨åˆ›å»ºæ’ä»¶é¡¹ç›®**ï¼Œéœ€è¦åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºåä¸º `manifest.yml` çš„æ–‡ä»¶ï¼Œå¹¶åœ¨ã€å±æ€§ã€‘ä¸­å°†ã€å¤åˆ¶åˆ°è¾“å‡ºç›®å½•ã€‘å±æ€§è®¾ç½®ä¸ºã€å¦‚æœè¾ƒæ–°åˆ™å¤åˆ¶ã€‘ã€‚è¿™æ ·åœ¨æ„å»ºæ—¶æ’ä»¶æ¸…å•æ–‡ä»¶ä¼šè¢«è‡ªåŠ¨å¤åˆ¶åˆ°è¾“å‡ºç›®å½•ã€‚

æ¸…å•æ–‡ä»¶å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š

| å±æ€§å | ç±»å‹ | å¿…å¡«ï¼Ÿ | è¯´æ˜ |
| -- | -- | -- | -- |
| id | `string` | **æ˜¯** | æ’ä»¶çš„å”¯ä¸€ id |
| entranceAssembly | `string` | **æ˜¯** | æ’ä»¶å…¥å£ç¨‹åºé›†ã€‚åœ¨åŠ è½½æ’ä»¶æ—¶å°†ä»è¿™ä¸ªç¨‹åºé›†ä¸­æŸ¥æ‰¾æ’ä»¶å…¥å£ç‚¹ã€‚ |
| apiVersion | `Version` | **æ˜¯** | æ­¤æ’ä»¶é¢å‘çš„ ClassIsland ç‰ˆæœ¬ã€‚æ­¤æ’ä»¶å°†åªèƒ½åœ¨é«˜äºæ­¤ç‰ˆæœ¬çš„ ClassIsland ä¸Šå·¥ä½œã€‚ |
| name | `string` | å¦ | æ’ä»¶æ˜¾ç¤ºåç§° |
| description | `string` | å¦ | æ’ä»¶æè¿° |
| url | `string` | å¦ | æ’ä»¶ä¸»é¡µ Url |
| author | `string` | å¦ | æ’ä»¶ä½œè€… |
| version | `Version` | å¦ | æ’ä»¶ç‰ˆæœ¬ï¼Œå¦‚`1.0.0.0` |
| icon | `string` | å¦ | æ’ä»¶å›¾æ ‡æ–‡ä»¶åï¼Œé»˜è®¤å€¼ä¸º`icon.png` |
| readme | `string` | å¦ | æ’ä»¶è‡ªè¿°æ–‡ä»¶æ–‡ä»¶åï¼Œé»˜è®¤ä¸º`README.md` |

ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ¸…å•æ–‡ä»¶çš„ç¤ºä¾‹ï¼š

```yaml title="manifest.yml"
id: examples.helloworld  # æ’ä»¶ id
name: Hello world!  # æ’ä»¶åç§°
apiVersion: 1.4.2.0  # æ’ä»¶é¢å‘çš„ ClassIsland ç‰ˆæœ¬
description: åœ¨å¯åŠ¨æ—¶å¼¹å‡ºä¸€ä¸ªâ€œHello worldâ€æç¤ºæ¡†ã€‚  # æ’ä»¶æè¿°
entranceAssembly: "HelloWorldPlugin.dll"  # æ’ä»¶å…¥å£ç¨‹åºé›†
url: https://github.com/ClassIsland/ExamplePlugins  # æ’ä»¶ Url
author: HelloWRC  # æ’ä»¶ä½œè€…
version: 1.0.0.0  # æ’ä»¶ç‰ˆæœ¬
```

## æ’ä»¶å…¥å£ç‚¹

åŠ è½½æ’ä»¶æ—¶ï¼Œå°†ä»æ¸…å•æ–‡ä»¶æ ‡è®°çš„å…¥å£ç¨‹åºé›†ä¸­æŸ¥æ‰¾ä»¥ `ClassIsland.Core.Abstractions.PluginBase` ä¸ºåŸºç±»ï¼Œä¸”å¸¦æœ‰ `ClassIsland.Core.Attributes.PluginEntrance` å±æ€§çš„ç±»ä½œä¸ºæ’ä»¶å…¥å£ç‚¹ï¼Œå¹¶è°ƒç”¨ `Initialize` æ–¹æ³•è¿è¡Œæ’ä»¶è‡ªå®šä¹‰çš„åˆå§‹åŒ–å‡½æ•°ã€‚

**å¦‚æœæ‚¨æ‰‹åŠ¨åˆ›å»ºæ’ä»¶é¡¹ç›®**ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªåä¸º `Plugin` çš„ç±»ï¼Œç»§æ‰¿ `ClassIsland.Core.Abstractions.PluginBase` ï¼Œå¹¶ä¸ºç±»æ·»åŠ  `ClassIsland.Core.Attributes.PluginEntrance` å±æ€§ã€‚

```csharp title="Plugin.cs"
using ClassIsland.Core.Abstractions;
using ClassIsland.Core.Attributes;
using ClassIsland.Core.Controls.CommonDialog;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;

namespace HelloWorldPlugin;

[PluginEntrance]
public class Plugin : PluginBase
{
    public override void Initialize(HostBuilderContext context, IServiceCollection services)
    {
    }
}
```

ç„¶åä¸ºåˆå§‹åŒ–æ–¹æ³• `Initialize` æ–¹æ³•æ·»åŠ å¦‚ä¸‹è¯­å¥ï¼Œä»¥åœ¨åŠ è½½æ’ä»¶æ—¶æ˜¾ç¤ºâ€œHello world!â€æç¤ºæ¡†ã€‚

```csharp title="Plugin.cs" hl_lines="9"
// ...
namespace HelloWorldPlugin;

[PluginEntrance]
public class Plugin : PluginBase
{
    public override void Initialize(HostBuilderContext context, IServiceCollection services)
    {
        CommonDialog.ShowInfo("Hello world!");
    }

    // ...
}
```

::: tip
æ‚¨è¿˜å¯ä»¥åœ¨ `Initialize` ä¸­å®Œæˆç›¸å…³æœåŠ¡çš„æ³¨å†Œï¼Œè¯¦ç»†ä¿¡æ¯è¯·è§[æ­¤æ–‡ç« ](./basics.md#ä¾èµ–æ³¨å…¥)ã€‚
:::

å…³äºæ’ä»¶å…¥å£ç±»çš„è¯¦ç»†ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒæ–‡æ¡£[æ’ä»¶å…¥å£ç±»](./plugin-base.md)ã€‚

## é…ç½®ä¸»é¢˜

åœ¨æ’ä»¶ä¸­å¼•å…¥æ§ä»¶æ ·å¼éœ€è¦æŒ‡å®šé»˜è®¤ä¸»é¢˜å­—å…¸ã€‚

**å¦‚æœæ‚¨æ‰‹åŠ¨åˆ›å»ºæ’ä»¶é¡¹ç›®**ï¼Œéœ€è¦æ–°å»º `AssemblyInfo.cs`ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼ŒæŒ‡å®šä¸»é¢˜èµ„æºå­—å…¸çš„ä½äºå½“å‰ç¨‹åºé›†ï¼š

``` csharp title="AssemblyInfo.cs"
using System.Windows;

[assembly: ThemeInfo(
    ResourceDictionaryLocation.None, 
    ResourceDictionaryLocation.SourceAssembly
)]
```

::: note
å…³äºæ­¤å±æ€§çš„è¯¦ç»†ç”¨æ³•ï¼Œè¯·è§[æ–‡æ¡£](https://learn.microsoft.com/zh-cn/dotnet/api/system.windows.themeinfoattribute?view=windowsdesktop-8.0)ã€‚
:::

åˆ›å»º `Themes/Generic.xaml`ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼Œå¼•ç”¨ä¸»é¢˜èµ„æºå­—å…¸ï¼š

``` xml title="Themes/Generic.xaml"
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="pack://application:,,,/ClassIsland.Core;;;component/ThemeBase.xaml"/>
    </ResourceDictionary.MergedDictionaries>
</ResourceDictionary>
```

## é…ç½®å¯åŠ¨é¡¹ç›®

éœ€è¦ä»¥ ClassIsland æœ¬ä½“ä¸ºè½½ä½“ä»¥è¿è¡Œå’Œè°ƒè¯•æ’ä»¶ã€‚

**å¦‚æœæ‚¨æ‰‹åŠ¨åˆ›å»ºæ’ä»¶é¡¹ç›®**ï¼Œéœ€è¦å‘ `launchSettings.json` ä¸­æ·»åŠ ä¸‹è¿°å†…å®¹ï¼š

```json {4-9} title="launchSettings.json"
{
    "profiles": {
        // ...
        "ClasssIsland æ’ä»¶": {
        "commandName": "Executable",
        "executablePath": "$(ClassIsland_DebugBinaryFile)",
        "commandLineArgs": "-epp $(TargetDir)",
        "workingDirectory": "$(ClassIsland_DebugBinaryDirectory)"
        }
    }
}
```

ä»¥ä¸Šé…ç½®æ­¥éª¤å®Œæˆåï¼Œå…³é—­ã€å¯åŠ¨é…ç½®æ–‡ä»¶ã€‘çª—å£ï¼Œç„¶ååˆ‡æ¢åˆ°åˆšåˆšæ·»åŠ çš„å¯åŠ¨é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨è°ƒè¯•ã€‚å¦‚æœæ²¡æœ‰å·®é”™ï¼Œæ‚¨å¯ä»¥çœ‹åˆ° ClassIsland æ­£å¸¸å¯åŠ¨ï¼Œå¹¶å¼¹å‡ºäº†ç”±æ’ä»¶æ˜¾ç¤ºçš„æç¤ºæ¡†ã€‚

![1721874637367](image/create-project/1721874637367.png)

ğŸ‰æ­å–œï¼æ‚¨æˆåŠŸåˆ›å»ºäº†æ‚¨çš„ç¬¬ä¸€ä¸ªæ’ä»¶ï¼

## ç»§ç»­æ·±å…¥

æ‚¨å¯ä»¥ç»§ç»­é˜…è¯»æ–‡ç« æ¥è¿›ä¸€æ­¥äº†è§£ç›¸å…³ API çš„ç”¨æ³•ï¼Œæˆ–è€…æŸ¥çœ‹ GitHub ä¸Šçš„ [æ’ä»¶ç¤ºä¾‹](https://github.com/ClassIsland/ExamplePlugins)ã€‚
